<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <title>Login - Yato Brechó</title>
    <link rel="stylesheet" href="../styles/login.css" />
  </head>
  <body>
    <section class="pagina_login">
      <!-- VLibras Plugin -->
      <div vw class="enabled">
        <div vw-access-button class="active"></div>
        <div vw-plugin-wrapper>
          <div class="vw-plugin-top-wrapper"></div>
        </div>
      </div>

      <div class="login-box">
        <h2>Entrar Yato Brechó</h2>
        <form id="loginForm">
          <label for="nome">Nome:</label>
          <input type="text" id="nome" name="nome" placeholder="Digite seu nome" required />

          <label for="senha">Senha:</label>
          <input type="password" id="senha" name="senha" placeholder="Digite sua senha" required />

          <button type="submit">Entrar</button>
        </form>

        <p id="mensagem"></p>
        <p class="cadastrar">
          <a href="cadastro.html">Cadastrar-se</a>
        </p>
      </div>

      <script src="https://vlibras.gov.br/app/vlibras-plugin.js"></script>
      <script>
        new window.VLibras.Widget('https://vlibras.gov.br/app');

        document.getElementById('loginForm').addEventListener('submit', async function (event) {
          event.preventDefault();

          const nome = document.getElementById('nome').value;
          const senha = document.getElementById('senha').value;
          const mensagem = document.getElementById('mensagem');

          try {
            const resposta = await fetch('/.netlify/functions/cliente', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ acao: 'login', nome, senha })
            });

            const dados = await resposta.json();

            if (dados.sucesso) {
              mensagem.textContent = 'Login realizado com sucesso!';

              // ✅ Salva o nome como objeto JSON
              localStorage.setItem('usuarioLogado', JSON.stringify({ nome: dados.nome }));

              if (dados.tipo_usuario === 'administrador') {
                window.location.href = 'admin.html';
              } else if (dados.tipo_usuario === 'cliente') {
                window.location.href = 'cliente.html';
              } else {
                mensagem.textContent = 'Tipo de usuário desconhecido.';
              }
            } else {
              mensagem.textContent = dados.mensagem;
            }
          } catch (erro) {
            mensagem.textContent = 'Erro ao conectar com o servidor.';
          }
        });
      </script>
    </section>
  </body>
</html>